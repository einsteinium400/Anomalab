#:kivy 2.1
#:import Factory kivy.factory.Factory

ScreenManager:
    Login:
    ChooseDataset:
    Query:
    Results:
    DataAnalystMenu:
    ManageDatasets:
    AddDataset:
    DeleteDataset:
    ManageDistanceFunctions:
    AddDistanceFunction:
    DeleteDistanceFunction:
    UpdateModels:
    ManageUsers:
    AddUser:
    UDUser:
    ChooseModels:
    AnalystResults:

# ---HEADER WIDGETS---
<LogoImage@Image>:
    source: app.logo
    pos_hint: {"x":0.2, "top": 0.9}
    size_hint: (0.6, 0.4)
<HeaderText@MDLabel>:
    font_size: 40
    pos_hint: {"x":0.3, "top": 0.4}
    size_hint: (0.4, 0.3)
    halign: "center"
<HeaderButton@MDFillRoundFlatButton>:
    text: 'Logout'
    pos_hint: {"x":0.7, "top": 0.75}
    font_size: 24
    size_hint: (0.2, 0.5)
# ---GENERAL INPUT
<FreeTextInput@MDTextField>:
    max_text_length: 30
    multiline: False
    padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
    font_size: 24
    mode: "rectangle"
<MainSpinnerOption@SpinnerOption>:
    font_size: 24
<MainSpinner@Spinner>:
    id: spinner_id
    pos_hint: {"x":0.25, "top": 0.6}
    size_hint: (0.5, 0.2)
    font_size: 24
    option_cls: "MainSpinnerOption"
# ---QUERY INPUT
<QueryLabel@MDLabel>:
    halign: "center"
    text_size: root.width, None
    size: self.texture_size
# ---FOOTER BUTTONS
<FooterButton@MDFillRoundFlatButton>:
    font_size: 24
    size_hint: (0.2, 0.4)
# ---FILE CHOOSER---#
<FileChooserListView>:
    # --------------------
    # ADD BACKGROUND COLOR
    # --------------------
    # canvas.before:
    #    Color:
    #        rgb: 1, 1, 1
    #    Rectangle:
    #        pos: self.pos
    #        size: self.size
    layout: layout
    FileChooserListLayout:
        id: layout
        controller: root

[FileListEntry@FloatLayout+TreeViewNode]:
    locked: False
    entries: []
    path: ctx.path
    # FIXME: is_selected is actually a read_only treeview property. In this
    # case, however, we're doing this because treeview only has single-selection
    # hardcoded in it. The fix to this would be to update treeview to allow
    # multiple selection.
    is_selected: self.path in ctx.controller().selection

    orientation: 'horizontal'
    size_hint_y: None
    height: '48dp' if dp(1) > 1 else '24dp'
    # Don't allow expansion of the ../ node
    is_leaf: not ctx.isdir or ctx.name.endswith('..' + ctx.sep) or self.locked
    on_touch_down: self.collide_point(*args[1].pos) and ctx.controller().entry_touched(self, args[1])
    on_touch_up: self.collide_point(*args[1].pos) and ctx.controller().entry_released(self, args[1])
    BoxLayout:
        pos: root.pos
        size_hint_x: None
        width: root.width - dp(10)
        Label:
            # --------------
            # CHANGE FONT COLOR
            # --------------
            color: 0, 0, 0, 1
            id: filename
            text_size: self.width, None
            halign: 'left'
            shorten: True
            text: ctx.name
        Label:
            # --------------
            # CHANGE FONT COLOR
            # --------------
            color: 0, 0, 0, 1
            text_size: self.width, None
            size_hint_x: None
            halign: 'right'
            text: '{}'.format(ctx.get_nice_size())

# ---SECTIONS---
<Window@MDFloatLayout>:
    size: root.width, root.height
    canvas.before:
        Color:
            rgba: (1,1,1,1)
        Rectangle:
            pos: self.pos
            size: self.size
<Header@MDFloatLayout>:
    pos_hint: {"x":0, "top": 1}
    size_hint: (1, 0.2)
    spacing: 10
    #canvas.before:
        #Color:
            #rgba: (1,0,0,1)
        #Rectangle:
            #pos: self.pos
            #size: self.size
<Main@MDFloatLayout>:
    id: main
    orientation: "vertical"
    pos_hint: {"x":0, "top": 0.8}
    size_hint: (1, 0.65)
    spacing: 20
    #canvas.before:
        #Color:
            #rgba: (0,1,0,1)
        #Rectangle:
            #pos: self.pos
            #size: self.size
<Footer@MDFloatLayout>:
    id: footer
    pos_hint: {"x":0, "top": 0.15}
    size_hint: (1, 0.15)
    #canvas.before:
        #Color:
            #rgba: (0,0,1,1)
        #Rectangle:
            #pos: self.pos
            #size: self.size
# ---1---
<Login>:
    name: "login"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Login"
            HeaderButton:
                text: "exit"
                on_release: root.close()
        Main:
            FreeTextInput:
                id: user_name
                hint_text: "username"
                logo_right: "account"
                pos_hint: {"x":0.25, "top": 0.7}
                size_hint: (0.5, 0.15)
            FreeTextInput:
                id: user_pass
                hint_text: "password"
                logo_right: "eye-off"
                pos_hint: {"x":0.25, "top": 0.45}
                size_hint: (0.5, 0.15)
                password: True
        Footer:
            FooterButton:
                text: "LOGIN"
                pos_hint: {"x":0.4, "top": 0.6}
                on_release: root.do_login(user_name.text, user_pass.text)
# ---2---
<ChooseDataset>:
    name: "choosedataset"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Choose Dataset"
            HeaderButton:
                on_release: root.logout()
        Main:
            MainSpinner:
                text: "Choose Dataset"
                id: spinner_id
                pos_hint: {"x":0.25, "top": 0.6}
                size_hint: (0.5, 0.2)
                font_size: 24
        Footer:
            id: footer_place
            FooterButton:
                id: apply_button
                text: "Apply"
                pos_hint: {"x":0.25, "top": 0.6}
                on_press: root.on_choose(spinner_id.text)
            FooterButton:
                id: back_button
                text: "Back"
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---3---
<Query>:
    name: "query"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Insert Query"
            HeaderButton:
                on_release: root.logout()
        Main:
            GridLayout:
                pos_hint: {"x":0.05, "top": 0.95}
                size_hint: (0.9, 0.9)
                cols: 4
                row_force_default: True
                row_default_height: 40
                id: attributes_box
        Footer:
            FooterButton:
                text: 'Apply'
                pos_hint: {"x":0.25, "top": 0.6}
                size_hint: (0.2, 0.4)
                on_press: root.on_apply()
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---4---
<Results>:
    name: "results"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Results"
            HeaderButton:
                on_release: root.logout()
        Main: 
            MDLabel:
                id: result
                text: "results"
                markup: True
                font_size: 24
                pos_hint: {"x":0.1, "top": 1}
                size_hint: (0.8, 0.05)
                halign: "center"
            BoxLayout:
                id: table_place
                pos_hint: {"top": 0.95}
                size_hint: (0.5, 0.95)
            BoxLayout:
                id: plot_place
                pos_hint: {"x": 0.5, "top": 0.95}
                size_hint: (0.5, 0.95)
        Footer:
            FooterButton:
                text: 'Another query'
                pos_hint: {"x":0.4, "top": 0.6}
                on_press: root.on_back()
# ---5---
<DataAnalystMenu>:
    name: "dataanalystmenu"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Menu"
            HeaderButton:
                on_release: root.logout()
        Main:
            MDFillRoundFlatButton:
                pos_hint: {"x":0.1, "top": 0.9}
                size_hint: (None, 0.35)
                width: dp(300) if root.width*0.35 <= dp (300) else root.width*0.35
                text: 'Try Query'
                font_size: 24
                on_release: root.chooseScreen("choosedataset")
            MDFillRoundFlatButton:
                pos_hint: {"right":0.9, "top": 0.9}
                size_hint: (None, 0.35)
                width: dp(300) if root.width*0.35 <= dp (300) else root.width*0.35
                text: 'Manage Datasets'
                font_size: 24
                on_release: root.chooseScreen("managedatasets")
            MDFillRoundFlatButton:
                pos_hint: {"x":0.1, "y": 0.1}
                size_hint: (None, 0.35)
                width: dp(300) if root.width*0.35 <= dp (300) else root.width*0.35
                text: 'Manage Distance Functions'
                font_size: 24
                on_release: root.chooseScreen("managedistancefunctions")
            MDFillRoundFlatButton:
                pos_hint: {"right":0.9, "y": 0.1}
                size_hint: (None, 0.35)
                width: dp(300) if root.width*0.35 <= dp (300) else root.width*0.35
                text: 'Update Models'
                font_size: 24
                on_release: root.chooseScreen("updatemodels")
        Footer:
# ---6---
<ManageDatasets>:
    name: "managedatasets"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Manage Datasets"
            HeaderButton:
                on_release: root.logout()
        Main:
            id: table_place
        Footer:
            FooterButton:
                text: 'Add'
                pos_hint: {"x":0.25, "top": 0.6}
                on_press: root.on_add()
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---7---
<AddDataset>:
    name: "adddataset"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Add Dataset"
                id: header
            HeaderButton:
                on_release: root.logout()
        Main:
            FreeTextInput:
                id: name
                hint_text: "Name"
                pos_hint: {"x":0.3, "top": 1}
                size_hint: (0.4, 0.2)
            FreeTextInput:
                id: path
                max_text_length: 100
                pos_hint: {"x":0.1, "top": 0.8}
                size_hint: (0.8, 0.2)
                hint_text: "File Path"
            FileChooserListView:
                id: filechooser
                color: (0,1,1,1)
                pos_hint: {"x":0.1, "top": 0.6}
                size_hint: (0.8, 0.6)
                on_selection: root.selected(filechooser.selection)
        Footer:
            FooterButton:
                text: 'Apply'
                pos_hint: {"x":0.25, "top": 0.7}
                on_press: root.on_add(name.text, path.text)
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.7}
                on_press: root.on_back()
# ---8---
<DeleteDataset>:
    name: "deletedataset"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Delete Dataset"
                id: header
            HeaderButton:
                on_release: root.logout()
        Main:
            MDLabel:
                id: name
                pos_hint: {"x":0.3, "top": 1}
                size_hint: (0.4, 0.2)
                font_size: 24
            MDLabel:
                id: features
                pos_hint: {"x":0.3, "top": 0.75}
                size_hint: (0.4, 0.2)
                font_size: 24
            MDLabel:
                id: instances
                pos_hint: {"x":0.3, "top": 0.5}
                size_hint: (0.4, 0.2)
                font_size: 24
            MDLabel:
                id: timestamp
                pos_hint: {"x":0.3, "top": 0.25}
                size_hint: (0.4, 0.2)
                font_size: 24
        Footer:
            FooterButton:
                text: 'Delete'
                pos_hint: {"x":0.25, "top": 0.7}
                on_press: root.on_delete()
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.7}
                on_press: root.on_back()
# ---9---
<ManageDistanceFunctions>:
    name: "managedistancefunctions"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Manage Distance Functions"
            HeaderButton:
                on_release: root.logout()
        Main:
            id: table_place
        Footer:
            FooterButton:
                text: 'Add'
                pos_hint: {"x":0.25, "top": 0.6}
                on_press: root.on_add()
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---10---
<AddDistanceFunction>:
    name: "adddistancefunction"
    Window:
        Header:
            LogoImage:
            HeaderText:
                id : header
                text: "Add distance function"
            HeaderButton:
                on_release: root.logout()
        Main:
            FreeTextInput:
                id: path
                max_text_length: 100
                pos_hint: {"x":0.1, "top": 0.95}
                size_hint: (0.8, 0.2)
                hint_text: "File Path"
                text: ""
            FileChooserListView:
                id: filechooser
                pos_hint: {"x":0.1, "top": 0.7}
                size_hint: (0.8, 0.65)
                on_selection: root.selected(filechooser.selection)
        Footer:
            FooterButton:
                id: apply
                text: "Add"
                pos_hint: {"x":0.25, "top": 0.6}
                on_press: root.on_add(path.text)
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---11---
<DeleteDistanceFunction>:
    name: "deletedistancefunction"
    Window:
        Header:
            LogoImage:
            HeaderText:
                id : header
                text: "Delete distance function"
            HeaderButton:
                on_release: root.logout()
        Main:
            MDLabel:
                id: name
                pos_hint: {"x":0.3, "top": 0.6}
                size_hint: (0.4, 0.2)
                font_size: 24

        Footer:
            FooterButton:
                text: "Delete"
                pos_hint: {"x":0.25, "top": 0.6}
                on_press: root.on_delete(name.text)
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---12---
<UpdateModels>:
    name: "updatemodels"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Update Models"
            HeaderButton:
                on_release: root.logout()
        Main:
            id: table_place
        Footer:
            FooterButton:
                text: 'Update'
                pos_hint: {"x":0.25, "top": 0.6}
                on_press: root.on_update()
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---13---
<ManageUsers>:
    name: "manageusers"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Manage Users"
            HeaderButton:
                on_release: root.logout()
        Main:
            id: table_place
        Footer:
            FooterButton:
                text: 'Add User'
                pos_hint: {"x":0.4, "top": 0.6}
                on_press: root.on_add()
# ---14--- 
<AddUser>:
    name: "adduser"
    Window:
        Header:
            LogoImage:
            HeaderText:
                id: header
                text: "Add User"
            HeaderButton:
                on_release: root.logout()
        Main:
            FreeTextInput:
                id: name
                hint_text: "Name"
                pos_hint: {"x":0.3, "top": 0.9}
                size_hint: (0.4, 0.2)
            FreeTextInput:
                id: password
                hint_text: "Password"
                pos_hint: {"x":0.3, "top": 0.6}
                size_hint: (0.4, 0.2)
            MainSpinner:
                id: type
                text: "Type"
                values: ["regular","analyst","admin"]
                pos_hint: {"x":0.3, "top": 0.3}
                size_hint: (0.4, 0.2)
        Footer:
            FooterButton:
                text: 'Apply'
                pos_hint: {"x":0.2, "top": 0.7}
                on_press: root.on_apply(name.text, password.text, type.text)
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.6, "top": 0.7}
                on_press: root.on_back()
# ---15---
<UDUser>:
    name: "uduser"
    Window:
        Header:
            LogoImage:
            HeaderText:
                id: header
                text: "Update User"
            HeaderButton:
                on_release: root.logout()
        Main:
            MDLabel:
                id: name
                hint_text: "Name"
                halign: "center"
                pos_hint: {"x":0.3, "top": 0.8}
                size_hint: (0.4, 0.2)
                font_size: 32
            MainSpinner:
                id: type
                text: "Type"
                values: ["regular","analyst","admin"]
                pos_hint: {"x":0.3, "top": 0.4}
                size_hint: (0.4, 0.2)
        Footer:
            FooterButton:
                text: 'Update Type'
                pos_hint: {"x":0.15, "top": 0.7}
                on_press: root.on_apply(name.text, type.text)
            FooterButton:
                text: 'Delete'
                pos_hint: {"x":0.4, "top": 0.7}
                on_press: root.on_delete(name.text)
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.65, "top": 0.7}
                on_press: root.on_back()            
# ---16---
<ChooseModels>:
    name: "choosemodels"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Choose Models"
            HeaderButton:
                on_release: root.logout()
        Main:
            id: table_place
        Footer:
            FooterButton:
                text: 'Choose'
                pos_hint: {"x":0.25, "top": 0.6}
                on_press: root.on_choose()
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.55, "top": 0.6}
                on_press: root.on_back()
# ---17---
<AnalystResults>:
    name: "analystresults"
    Window:
        Header:
            LogoImage:
            HeaderText:
                text: "Analyst Results"
            HeaderButton:
                on_release: root.logout()
        Main:
            id: table_place
        Footer:
            FooterButton:
                text: 'Back'
                pos_hint: {"x":0.4, "top": 0.6}
                on_press: root.on_back()